# Web Timer for Shortcuts Automation (Shortcuts連携用)

このリポジトリは、iPhoneのShortcutsの個人用オートメーションで「特定アプリを開いたらWebタイマーを開く」体験を検証するための最小実装です。

特徴
- 純HTML/CSS/JS（ビルド不要）
- ページ読み込み直後に自動でカウントダウンが開始（デフォルト60秒）
- クエリで秒数とラベルを指定可能：`?sec=90&label=Break`
- ボタンは一切無し。再スタートはページ再読み込みまたはショートカット再実行。
- 外部通信・解析なし

---

## ファイル構成

- `index.html` - タイマー本体（読み込み直後に自動開始）
- `style.css` - 中央に大きな等幅数字
- `app.js` - カウントダウン、クエリ解析、可視制御
- `assets/icon-192.png` - ダミーアイコン
- `LICENSE` - MIT

---

## クイックスタート（ローカルで確認）
1. このフォルダをGitで初期化し、ファイルを追加してコミットします。
2. `index.html` をブラウザで開くと即時60秒カウントが開始します。
3. クエリで動作確認：`index.html?sec=10&label=Test` で10秒・タイトルに `Test` が反映されます。

---

## GitHub Pages で公開する手順
1. GitHub に新規リポジトリを作成。
2. 本フォルダのファイルを push します（例：`main` ブランチ）。
3. GitHubのリポジトリ > `Settings` > `Pages` に移動。
4. `Deploy from a branch` を選択し、公開したいブランチ／ルート（例：`main` / `/ (root)`）を選択。
5. Save または Deploy を押してビルドを待つ。
6. 公開アドレス（`https://<ユーザー名>.github.io/<リポジトリ名>/`）を確認。

公開アドレスにアクセスすると、ページ読み込みで自動的にカウントが始まります。必要に応じて `?sec=120&label=Focus` のようにクエリを付与してください。

---

## iPhone Shortcuts の設定手順
1. Shortcuts を開く。
2. 下部の `Automation` タブを選択。
3. `Create Personal Automation`（個人用オートメーション）を選ぶ。
4. `App` を選択し、対象アプリを選択。
5. `When` は `Is Opened`（開いたとき）を選択して `Next`。
6. `Add Action` を押し、検索で `Open URLs` を選択。
7. URL フィールドに GitHub Pages の公開アドレスを入力（例：`https://<user>.github.io/<repo>/`）。
   - クエリを付けたい場合は `https://.../?sec=60&label=Focus` のようにします。
8. `Next` を押す。
9. `Ask Before Running`（実行前に尋ねる）をオフにする（これをオフにすることで自動実行されます）。
10. `Done` をタップして保存。

以降、対象アプリを開くとショートカットが自動的に実行され、ブラウザで本タイマーが開きカウントが開始します。

> 注意：iOS のバージョンやSafariの設定によっては、短時間でのアプリ切り替えやバックグラウンドからの実行に差異があります。

---

## 再スタート方法
画面上にボタンはありません。再スタートしたい場合はページを再読み込みするか、ショートカットを再度実行してください。

---

## 実装ノート / 技術的注意点
- `sec` は 1〜3600 の範囲でバリデーションされます。
- `label` は 0〜32 文字に切り詰めます。
- 時間は `startAt = Date.now()` を基準に計測するため、タブが非可視になって復帰しても実際の経過時間に基づいて残秒が算出されます。
- 終了時は画面を短時間フラッシュし、`navigator.vibrate` が利用可能なら振動を行います。自動音声再生は行いません。
- Wake Lock（`navigator.wakeLock.request('screen')`）は、ユーザー操作がない状態では要求していません。必要な場合は PWA 化やユーザー操作トリガで試行してください。

---

## 既知の制約
- Safari/iOS では自動再生やWake Lockの挙動がブラウザ・バージョンによって異なります。
- Shortcuts の `Open URLs` は対象アプリからSafari（または指定のブラウザ）へ切り替えるため、UI フローに短い遅延が入る場合があります。

---

## QA 手順
- `?sec=10` で動作確認：10→0へカウントし、終了時に画面フラッシュ・振動が発生する。
- バックグラウンドに移した後復帰しても残秒のズレが±1秒以内であることを確認する。
- Shortcuts のオートメーションを作り、対象アプリを開いて自動でブラウザが起動することを確認する（`Ask Before Running` をオフにすること）。

---

## ライセンス
MIT
