# 深呼吸アプリ - 60秒瞑想タイマー

60秒間の深呼吸アニメーションを表示するモバイル向けWebアプリです。ページを開くと自動的に開始され、円形アニメーションと呼吸ガイドで深呼吸をサポートします。

## 特徴

- 📱 **モバイル最適化**: スマートフォンでの使用を前提とした設計
- 🌀 **呼吸アニメーション**: 円が拡大/縮小して呼吸のリズムをガイド  
- ⏱️ **正確な時間管理**: Date.now()ベースで遅延に影響されない
- 🔄 **自動開始**: ページを開くと1秒後に自動で開始
- 🎨 **ダークモード対応**: システム設定に応じて自動切り替え
- ♿ **アクセシビリティ**: モーションセンシティビティ対応、aria-live属性
- 📶 **オフライン対応**: 外部リソース不使用

## クイックスタート

### ローカルで開く

```bash
# このリポジトリをクローン
git clone https://github.com/cayenneheart/github.io.git
cd github.io

# 簡易サーバーで起動
python3 -m http.server 8000
# または
npx serve .

# ブラウザで開く
open http://localhost:8000
```

### GitHub Pages で公開

1. GitHub リポジトリの Settings → Pages に移動
2. Source を "Deploy from a branch" に設定
3. Branch を "main" / root に設定
4. Save をクリック
5. 数分後に https://cayenneheart.github.io でアクセス可能

## 使用方法

### 基本的な使い方

1. URLを開くまたはブラウザでアクセス
2. 1秒後に自動で60秒タイマーが開始
3. 円のアニメーションに合わせて呼吸
   - **拡大時**: 息を吸う（4秒）
   - **静止時**: 息を止める（2秒）  
   - **縮小時**: 息を吐く（4秒）
4. 60秒で自動終了

### カスタマイズ（クエリパラメータ）

#### 合計時間の変更
```
?sec=90        # 90秒間の深呼吸
?sec=120       # 2分間の深呼吸
```

#### 呼吸パターンの変更
```
?pattern=4-4-4   # 吸う4秒-止める4秒-吐く4秒
?pattern=6-2-6   # 吸う6秒-止める2秒-吐く6秒
?pattern=3-3-3   # 吸う3秒-止める3秒-吐く3秒
```

#### 組み合わせ例
```
?sec=90&pattern=4-4-4    # 90秒間、4-4-4のパターン
?sec=120&pattern=6-2-6   # 2分間、6-2-6のパターン
```

### 再スタート方法

- ページを再読み込み（F5またはCmd+R）
- ショートカットアプリから再実行

## iOS ショートカット連携

このアプリは iOS ショートカットアプリとの連携を前提として設計されています。

1. ショートカットアプリで新規ショートカットを作成
2. "URL を開く" アクションを追加
3. URL に `https://cayenneheart.github.io` を設定
4. ホーム画面に追加

## 技術仕様

### ファイル構成

```
/
├── index.html    # メインページ（自動開始）
├── style.css     # レスポンシブスタイル＋アニメーション
├── app.js        # タイミング制御＋呼吸ロジック  
├── README.md     # このファイル
└── LICENSE       # MITライセンス
```

### ブラウザ対応

- iOS Safari 14+
- Android Chrome 80+
- Desktop Chrome/Firefox/Safari（最新版）

### パフォーマンス

- JavaScript < 10KB
- 初回描画 < 1秒（4G回線）
- 外部リソースなし（完全オフライン対応）

## 注意事項

- **音声なし**: iOS制約により自動音声再生は使用していません
- **通知なし**: バックグラウンド通知は使用していません
- **画面スリープ**: Wake Lock APIは使用していません（意図的）
- **再開機能なし**: 一時停止・再開ボタンはありません（ページ再読み込みで再開）

## カスタマイズ

### 呼吸パターンの追加

`app.js` の `parseParams()` メソッドでパターン検証を変更可能:

```javascript
// 例: 5段階パターンに拡張
if (pattern.some(n => n < 1 || n > 60)) {
  pattern = [4, 2, 4]; // デフォルトにフォールバック  
}
```

### デザインの変更

`style.css` のカスタムプロパティで簡単にカラーテーマを変更:

```css
:root {
  --circle-color: #007bff;  /* 円の色 */
  --bg-color: #f8f9fa;     /* 背景色 */
  --text-color: #212529;   /* テキスト色 */
}
```

## ライセンス

MIT License - 自由に使用・改変可能です。

## 貢献

プルリクエストやイシューの報告を歓迎します。

---

**作成**: 2025年 | **用途**: iOS ショートカット連携、深呼吸・瞑想支援

---

## ファイル構成

- `index.html` - タイマー本体（読み込み直後に自動開始）
- `style.css` - 中央に大きな等幅数字
- `app.js` - カウントダウン、クエリ解析、可視制御
- `assets/icon-192.png` - ダミーアイコン
- `LICENSE` - MIT

---

## クイックスタート（ローカルで確認）
1. このフォルダをGitで初期化し、ファイルを追加してコミットします。
2. `index.html` をブラウザで開くと即時60秒カウントが開始します。
3. クエリで動作確認：`index.html?sec=10&label=Test` で10秒・タイトルに `Test` が反映されます。

---

## GitHub Pages で公開する手順
1. GitHub に新規リポジトリを作成。
2. 本フォルダのファイルを push します（例：`main` ブランチ）。
3. GitHubのリポジトリ > `Settings` > `Pages` に移動。
4. `Deploy from a branch` を選択し、公開したいブランチ／ルート（例：`main` / `/ (root)`）を選択。
5. Save または Deploy を押してビルドを待つ。
6. 公開アドレス（`https://<ユーザー名>.github.io/<リポジトリ名>/`）を確認。

公開アドレスにアクセスすると、ページ読み込みで自動的にカウントが始まります。必要に応じて `?sec=120&label=Focus` のようにクエリを付与してください。

---

## iPhone Shortcuts の設定手順
1. Shortcuts を開く。
2. 下部の `Automation` タブを選択。
3. `Create Personal Automation`（個人用オートメーション）を選ぶ。
4. `App` を選択し、対象アプリを選択。
5. `When` は `Is Opened`（開いたとき）を選択して `Next`。
6. `Add Action` を押し、検索で `Open URLs` を選択。
7. URL フィールドに GitHub Pages の公開アドレスを入力（例：`https://<user>.github.io/<repo>/`）。
   - クエリを付けたい場合は `https://.../?sec=60&label=Focus` のようにします。
8. `Next` を押す。
9. `Ask Before Running`（実行前に尋ねる）をオフにする（これをオフにすることで自動実行されます）。
10. `Done` をタップして保存。

以降、対象アプリを開くとショートカットが自動的に実行され、ブラウザで本タイマーが開きカウントが開始します。

> 注意：iOS のバージョンやSafariの設定によっては、短時間でのアプリ切り替えやバックグラウンドからの実行に差異があります。

---

## 再スタート方法
画面上にボタンはありません。再スタートしたい場合はページを再読み込みするか、ショートカットを再度実行してください。

---

## 実装ノート / 技術的注意点
- `sec` は 1〜3600 の範囲でバリデーションされます。
- `label` は 0〜32 文字に切り詰めます。
- 時間は `startAt = Date.now()` を基準に計測するため、タブが非可視になって復帰しても実際の経過時間に基づいて残秒が算出されます。
- 終了時は画面を短時間フラッシュし、`navigator.vibrate` が利用可能なら振動を行います。自動音声再生は行いません。
- Wake Lock（`navigator.wakeLock.request('screen')`）は、ユーザー操作がない状態では要求していません。必要な場合は PWA 化やユーザー操作トリガで試行してください。

---

## 既知の制約
- Safari/iOS では自動再生やWake Lockの挙動がブラウザ・バージョンによって異なります。
- Shortcuts の `Open URLs` は対象アプリからSafari（または指定のブラウザ）へ切り替えるため、UI フローに短い遅延が入る場合があります。

---

## QA 手順
- `?sec=10` で動作確認：10→0へカウントし、終了時に画面フラッシュ・振動が発生する。
- バックグラウンドに移した後復帰しても残秒のズレが±1秒以内であることを確認する。
- Shortcuts のオートメーションを作り、対象アプリを開いて自動でブラウザが起動することを確認する（`Ask Before Running` をオフにすること）。

---

## ライセンス
MIT
