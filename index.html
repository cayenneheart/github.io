<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>深呼吸</title>
  <link rel="stylesheet" href="style.css">
  <meta name="apple-mobile-web-app-capable" content="yes">
</head>
<body>

  <!-- View: タイマー画面（自動開始 - 今は #timer 指定時のみ） -->
  <div id="view-timer" class="view" aria-hidden="true">
    <div class="timer" id="timer" aria-live="polite">20</div>
    <div class="breathing-container" aria-hidden="true">
      <div class="breathing-circle" id="breathingCircle"></div>
    </div>
    <div class="instruction" id="instruction" aria-live="polite">準備中...</div>
  </div>

  <!-- View: 完了画面 -->
  <div id="view-done" class="view" aria-hidden="true">
    <main class="app-main">
      <h2 id="done-heading" tabindex="-1">整いました。</h2>
      <p>次へ進みますか？</p>
      <div class="done-actions">
        <button id="backButton" class="button-secondary" disabled aria-disabled="true">元のアプリに戻る</button>
        <button id="maimeeButton" class="button-primary">mai-meeに戻る</button>
      </div>
    </main>
  </div>

  <!-- View: タスクリスト画面（デフォルト） -->
  <div id="view-routines" class="view active" aria-hidden="false">
    <header class="app-header">
      <h1>タスクリスト</h1>
      <p class="tagline">小さな行動を積み上げよう</p>
    </header>
    
    <main class="routines-main">
      <!-- ルーティーン一覧 -->
      <section class="routines-list" aria-label="ルーティーン一覧">
        <div id="routines-container">
          <div id="empty-state" class="empty-state">
            <p>まずは3つ登録してみましょう</p>
            <div class="seed-buttons">
              <button class="seed-btn" data-title="深呼吸" data-duration="20" data-emoji="🌬️">深呼吸 20秒</button>
              <button class="seed-btn" data-title="水を飲む" data-duration="15" data-emoji="💧">水を飲む 15秒</button>
              <button class="seed-btn" data-title="肩回し" data-duration="60" data-emoji="🤸">肩回し 60秒</button>
            </div>
          </div>
          <ul id="routines-list" class="routines" role="list">
            <!-- ルーティーンアイテムが動的に追加される -->
          </ul>
        </div>
      </section>
      
      <!-- 進捗セクション -->
      <section class="stats-section" aria-label="進捗状況">
        <div class="stats-container">
          <div class="stats-row">
            <span class="stat-label">今日：</span>
            <span id="today-count" class="stat-value">0回</span>
            <span class="stat-separator">｜</span>
            <span class="stat-label">連続：</span>
            <span id="streak-count" class="stat-value">0日</span>
            <span class="stat-separator">｜</span>
            <span class="stat-label">Lv.</span>
            <span id="level-count" class="stat-value">1</span>
          </div>
          <div class="xp-progress">
            <div class="progress-bar">
              <div id="xp-bar" class="progress-fill" style="width: 0%"></div>
            </div>
            <div id="xp-text" class="xp-label">次まで 100XP</div>
          </div>
        </div>
      </section>
    </main>
    <button id="fab-add" class="fab" aria-label="タスクを追加">＋</button>
  </div>

  <!-- View: タスク追加画面 -->
  <div id="view-add" class="view" aria-hidden="true">
    <header class="app-header">
      <h1>タスクを追加</h1>
    </header>
    <main class="add-main">
      <form id="add-task-form" class="task-form" aria-label="新規タスクフォーム">
        <div class="form-group">
          <label for="new-title">名前</label>
          <input type="text" id="new-title" maxlength="40" required placeholder="例：深呼吸">
        </div>
        <div class="form-group">
          <label for="new-duration">時間（秒）</label>
          <input type="number" id="new-duration" min="5" max="900" value="20" required>
        </div>
        <div class="form-group">
          <label for="new-emoji">絵文字（任意）</label>
          <input type="text" id="new-emoji" maxlength="2" placeholder="✨">
        </div>
        <div class="form-actions two">
          <button type="button" id="cancel-add" class="button-secondary">キャンセル</button>
          <button type="submit" class="button-primary">追加</button>
        </div>
      </form>
    </main>
  </div>

  <!-- 編集モーダル -->
  <div id="edit-modal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="modal-title">
    <div class="modal-content">
      <header class="modal-header">
        <h3 id="modal-title">ルーティーンを編集</h3>
        <button id="modal-close" class="close-btn" aria-label="閉じる">×</button>
      </header>
      <form id="edit-form" class="modal-form">
        <div class="form-group">
          <label for="edit-title">名前</label>
          <input type="text" id="edit-title" maxlength="40" required>
        </div>
        <div class="form-group">
          <label for="edit-duration">時間（秒）</label>
          <input type="number" id="edit-duration" min="10" max="900" required>
        </div>
        <div class="form-group">
          <label for="edit-emoji">絵文字（任意）</label>
          <input type="text" id="edit-emoji" maxlength="2">
        </div>
        <div class="form-actions">
          <button type="button" id="delete-routine" class="button-secondary">削除</button>
          <button type="submit" class="button-primary">保存</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script src="app.js"></script>
</body>
</html>